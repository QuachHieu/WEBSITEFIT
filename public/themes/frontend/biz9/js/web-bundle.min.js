function copyToClipboard(n){
    var t=$("<input>");
    $("body").append(t);t.val(n).select();
    document.execCommand("copy");
    t.remove()
}
function autosize(n,t){
    setTimeout(function(){
        $(n).css({height:"36px",resize:"none"});
        $(n).css({height:parseInt(n.scrollHeight<36?36:n.scrollHeight===undefined?36:n.scrollHeight)+parseInt(t===undefined?0:$(n).height()+t)+"px"})
    },0)
}
function ConvertJsonToDate(n){
    return new Date(n.match(/\d+/)[0]*1)
}
function ConvertDateJsonToDateVN(n){
    var t=ConvertJsonToDate(n);
    return"{0}:{1}:{2} {3}/{4}/{5}".format(t.getHours(),t.getMinutes(),t.getSeconds(),t.getDate(),t.getMonth()+1,t.getUTCFullYear())
}
function ConvertDateJsonToOnlyDateVN(n){
    var t=ConvertJsonToDate(n);
    return"{0}/{1}/{2}".format(t.getDate(),t.getMonth()+1<10?"0"+(t.getMonth()+1).toString():t.getMonth()+1,t.getUTCFullYear())
}
function getDomain(n,t){
    return(t=t||!1,n=n.replace(/(https?:\/\/)?(www.)?/i,""),t||(n=n.split("."),n=n.slice(n.length-2).join(".")),n.indexOf("/")!==-1)?n.split("/")[0]:n
}
function getContentType(n,t){
    if(n.endsWith(".jpg")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".webp")||n.endsWith(".gif")){
        t("image");return
    }
    if(n.indexOf("http://")===0&&isMobile===!0){
        t("text/html");return
    }var i=new XMLHttpRequest;i.open("GET",n,!1);
    
    try{i.send(null)}
    catch(r){
        t(i.getResponseHeader("Content-Type"))
    }
    i.readyState===4&&i.status===200&&t(i.getResponseHeader("Content-Type"))
}
function createHTMLNode(n){
    var t=document.createElement("div");
    return t.innerHTML=n,t
}
function replaceBreaksWithParagraphs(n){
    return n=filterEmpty(n.split("\n")).join("<\/p><p>"),"<p>"+n+"<\/p>"
}
function filterEmpty(n){
    for(var i=[],t=n.length-1;t>=0;t--)n[t]!==""?i.push(n.pop()):n.pop();return i.reverse()
}
function validURL(n){
    var t=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");
    return!!t.test(n)
}
function stripHtml(n){
    var t=document.createElement("DIV");
    return t.innerHTML=n,t.textContent||t.innerText||""
}
function isBlank(n){
    return!n||/^\s*$/.test(n)
}
function formatTD(n){
    return n.toString().length===1?"0"+n:n
}
function timeSince(n){
    var t=new Date(n),r=Math.floor((new Date-n)/1e3),i=Math.floor(r/31536e3);
    return i>1?formatTD(t.getDate())+"/"+formatTD(t.getMonth()+1)+"/"+t.getFullYear():(i=Math.floor(r/2592e3),i>1)?formatTD(t.getHours())+":"+formatTD(t.getMinutes())+" "+formatTD(t.getDate())+"/"+formatTD(t.getMonth()+1)+"/"+t.getFullYear():(i=Math.floor(r/86400),i>1)?formatTD(t.getHours())+":"+formatTD(t.getMinutes())+" "+formatTD(t.getDate())+"/"+formatTD(t.getMonth()+1):(i=Math.floor(r/3600),i>1)?i+" giờ trước":(i=Math.floor(r/60),i>1?i+" phút trước":r>60&&r<120?"1 phút trước":"vừa đăng")
}
function UpdateTime(n){
    if(n===undefined)$(".time-ago").each(function(){var n=$(this).attr("datetime").split(/[- :]/),t=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5],n[6]);$(this).html(timeSince(t))});else{var t=$(n).attr("datetime").split(/[- :]/),i=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]);$(this).html(timeSince(i))}
}
function GetArticleSave(){
    if(Client.UserID===""||Client.UserID==="0")return!1;
    $.getJSON("/ajax/article.ashx?type=fillter&articles="+arrayArticles,function(n){var i,t,r;if(n.Status===!0)for(i=JSON.parse(n.Content),t=0;t<i.length;t++)r=i[t],$(".story__react.love[data-article='"+r.NewsID+"']").addClass("is-checked").attr("data-id",r.ID);else alertify.notify(n.Content,"error",3)})}function popitup(n){var t=560,i=620,r=screen.width/2-t/2,u=screen.height/2-i/2;return newwindow=window.open(n,"name","height="+i+",width="+t+",toolbar=0,menubar=0,location=0,top="+u+",left="+r),window.focus&&newwindow.focus(),!1}function expandComposer(){$(".composer-wrap").addClass("is-active")
}
function collapseComposer(){
    $(".composer-wrap").removeClass("is-active");
    $("#mainComposer").val($("#editor").find("p").first().text())
}
function ScrapeArticle(n){
    $("#loading-container").removeClass("d-none");
    $.getJSON(Client.CrawlerAPI+n,function(t){
        if(!t.IsReadable){$("#loading-container").addClass("d-none");return
    }
    const i=`  <article class="story">
                        <figure class="story__thumb"><a href="{0}"  target='_blank'>
                            <img class="img-fluid" src="{1}" alt=""></a></figure>
                        <div class="story__header">
                            <div class="story__meta">                                
                                <div class="story__source"><strong>{2}</strong></div>
                            </div>
                            <h3 class="story__title"><a href="{0}" target='_blank'>{3}</a></h3>
                        </div>
                    </article>
                    <div class="delete">
                        <a href="javascript:void(0)" title='Xóa bài viết' id='aDeleteArticleScraped' onclick='DeleteArticleScraped(this)'><i class="fal fa-times"></i></a>
                    </div>`;
                    $("#scrape-article").html(i.format(t.Uri,t.FeaturedImage,getDomain(t.Uri,!0).toUpperCase(),t.Title)).removeClass("d-none");
                    $("#loading-container").addClass("d-none");
                    $("#hdScrapeArticle").val(n)})
}
function PostStatus(n,t){
    if(isBlank(stripHtml(t)))return alertify.notify("Nhập nội dung bạn muốn đăng","error",3),!1;
    $("#loading-container").removeClass("d-none");
    $.ajax({
        type:"POST",
        url:"/user/post.ashx",
        dataType:"json",
        data:{images:n,body:t,srapeurl:$("#hdScrapeArticle").val(),type:"manual"}
    }).done(function(n){
        $("#loading-container").addClass("d-none");
        n.Status===!0&&(
            $("#editor").html(""),
            $("#mainComposer").val(""),
            $("#gallery-images").html(""),
            $("#hdGalleryImages").val(""),
            autosize("#editor"),
            alertify.notify("Nội dung của bạn đã gửi chờ ban quản trị phê duyệt, xin cảm ơn!","success",3),
            $("#scrape-article").html("")
        )}
    ).fail(function(){
        $("#loading-container").addClass("d-none");
        alertify.notify("Bài đăng không thành công!","error",3)})
}
function BindGallery(n){
    for(var i,r="",t=0;t<n.length;t++)i=n[t],$("#hdGalleryImages").val($("#hdGalleryImages").val()+";"+i.FilePath),r+='<li class="gallery-item"><img src="'+Client.UrlStatic+"images/upload/w300/"+i.FilePath+'" class="img-fluid"><a onclick="RemoveParent(this)" href="javascript:void(0)" class="btn-close"><i class="fal fa-times"><\/i><\/a><\/li>';$("#gallery-images").html($("#gallery-images").html()+r)}function RemoveParent(n){var r=$(n).parent().parent(),i=$(n).parent(),t=$(i).find("img").attr("src");t=t.replace(Client.UrlStatic+"images/upload/w300/","");$("#hdGalleryImages").val($("#hdGalleryImages").val().replace(";"+t,""));i.remove();autosize(r)}function DeleteArticleScraped(n){$(n).parent().prev().remove();$(n).parent().remove()}var Images,Member,Following,FollowingArticles,ReportArticle,ArticlePr;$(function(){$(".auto-size").bind("paste",function(){autosize(this)});$(".auto-size").bind("keydown",function(n){n=n||window.event;n.keyCode!==13||$(this).hasClass("inputComment")||document.execCommand("formatBlock",!1,"p");autosize(this)});$(".auto-size").each(function(){autosize(this)});$("input,textarea").each(function(){$(this).attr("spellcheck","false")});$(".aMyFavorite").click(function(){Member.RequireLogin()||(window.location="/my-favorite.html")});$(".aMyFollowing").click(function(){Member.RequireLogin()||(window.location="/my-following.html")});$(".embed-youtube").each(function(){var n=parseInt($(this).attr("width"))*9/16;$(this).css({height:n+"px"})})});$(document).on("click","a.getLinkArticle",function(){copyToClipboard($(this).attr("data-url"));alertify.notify("Link bài viết đã được copy","success",3)});String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i].toString()!="undefined"?n[i]:t})});UpdateTime();$(function(){setInterval(UpdateTime,6e4)});class Utils{static ConvertJsonToDate(n){return new Date(n.match(/\d+/)[0]*1)}static validateEmail(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())}static ConvertDateJsonToDateVN(n){var t=Utils.ConvertJsonToDate(n);return"{0}:{1}:{2} {3}/{4}/{5}".format(t.getHours(),t.getMinutes(),t.getSeconds(),t.getDate(),t.getMonth()+1,t.getUTCFullYear())}static ConvertDateJsonToTimeVN(n){var t=Utils.ConvertJsonToDate(n);return"{0}/{1}/{2} {3}:{4}".format(t.getDate(),t.getMonth()+1<10?"0"+(t.getMonth()+1).toString():t.getMonth()+1,t.getUTCFullYear(),t.getHours()<10?"0"+t.getHours().toString():t.getHours(),t.getMinutes()<10?"0"+t.getMinutes().toString():t.getMinutes())}static ConvertDateJsonToOnlyDateVN(n){var t=Utils.ConvertJsonToDate(n);return"{0}/{1}/{2}".format(t.getDate(),t.getMonth()+1<10?"0"+(t.getMonth()+1).toString():t.getMonth()+1,t.getUTCFullYear())}static setCookie(n,t,i){var r=new Date,u;r.setDate(r.getDate()+i);u=escape(t)+(i==null?"":";path=/; expires="+r.toUTCString());document.cookie=n+"="+u}static createCookie(n,t){var i=new Date,r;i.setTime(i.getTime()+18e5);r="; expires="+i.toGMTString();document.cookie=n+"="+t+r+"; path=/"}static getCookie(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r===n)return unescape(u)}static deleteCookie(n){setCookie(n,"",-1)}}Images=function(){function r(n,t){if(t!==undefined&&$(t).removeClass("d-none"),n.lengthComputable){var i=n.loaded/n.total;i===1&&t!==undefined&&$(t).addClass("d-none")}else alert("Total size is unknown")}var n=function(n,t){var i=new FormData;i.append("data",n);i.append("userName",Client.UserName);i.append("userID",Client.UserID);i.append("callback","true");$.ajax(Client.UrlStatic+"uploadbase64.ashx",{method:"POST",data:i,processData:!1,contentType:!1,success:function(n){var i=JSON.parse(n);if(t){$(t).height($(t).height()+i.Height);const n="<figure class='iFigure'><label title='Xóa ảnh' class='btn-remove' onclick='RemoveParent(this)'><i class='fal fa-times'><\/i><\/label><img src='"+Client.UrlStatic+"images/upload/"+i.FilePath+"' /><\/figure><p>&nbsp;<\/p>";document.execCommand("insertHTML",!1,n)}},error:function(n){console.error(n)}})},t=function(n,t,i){t!==undefined&&$(t).removeClass("d-none");$.ajax({type:"POST",url:Client.UrlStatic+"/uploadimage.ashx",dataType:"json",data:{uploadtype:"url",userName:Client.UserName,userID:Client.UserID,urlimage:n}}).done(function(n){t!==undefined&&$(t).addClass("d-none");i===undefined?BindGallery([n]):i(n)}).fail(function(){t!==undefined&&$(t).addClass("d-none");alertify.notify('Tải ảnh không thành công"',"error",3)})},i=function(n,t){var u=n.files,s=u.length,e=new FormData,i,h,o,c,f;if(s>5)return alert("Tải lên tối đa 5 ảnh"),!1;for(i=0;i<s;i++){if(h=new FileReader,o=u[i].type,o!=="image/png"&&o!=="image/gif"&&o!=="image/jpeg")return alert("Không hỗ trợ upload file "+u[i].name+". Chọn lại ảnh để tiếp tục!"),$(n).val(""),!1;if(u[i].size/1048576>30)return alert(u[i].name+": > 30MB. Chọn lại ảnh để tiếp tục!"),$(n).val(""),!1;c=u[i].name;e.append("file",u[i]);i===0&&(e.append("userID",Client.UserID),e.append("userName",Client.UserName));h.readAsDataURL(u[i])}f=new XMLHttpRequest;f.upload.addEventListener("progress",r,!1);f.open("POST",Client.UrlStatic+"uploadImage.ashx",!0);f.onreadystatechange=function(n){var r,u,i;if(this.readyState===4&&this.status===200)if(r=JSON.parse(n.currentTarget.responseText),t===undefined)BindGallery(r);else for(u=0;u<r.length;u++)i=r[u],$(t).append('<img src="'+Client.UrlStatic+"images/upload/"+i.FilePath+'" class="img-fluid">'),autosize(t,i.Width>$(t).width()?$(t).width()/i.Width*i.Height:i.Height)};f.send(e)};return{UploadImageBase64:n,UploadImageViaUrl:t,UploadImage:i}}();Member=function(){let n=function(){return Client.UserID>0?!1:($("#loginModal").modal(),!0)},t=function(){};return{RequireLogin:n,Logout:t}}();$(function(){var n=$.connection.commentHub;n.client.broadcastLike=function(n,t){$("#likeNumber_"+n).html(t)};n.client.broadcastComment=function(n,t,i,r,u,f,e,o,s,h,c){var l,a,v;f===!0?(l=$("#"+n),o!==""&&(l=$("#"+o).find(".comment-reply")),o===""&&$(l).append('<div class="comment__item comment-parent" id='+e+'><div class="avatar"><img src="'+r+'" class="img-fluid rounded-circle" /><\/div><div class="content"><h3 class="name">'+i+' <time class="time-ago" datetime="'+u+'">vừa đăng<\/time><\/h3><div class="text">'+t+'<\/div><\/div><div class="comment-react"><a href="javascript:void(0)" title="Thích" class="text-link like"><i class="far fa-thumbs-up"><\/i><span id="likeNumber_'+e+'"><\/span><\/a><a href="javascript:void(0)" title="Trả lời" class="text-link reply"><i class="fal fa-reply"><\/i><\/a><a href="javascript:void(0)" title="Chia sẻ lên facebook" class="text-link share-quote"><i class="fal fa-share"><\/i><\/a><a href="javascript:void(0)" title="Báo cáo bình luận không phù hợp" class="text-link report"><i class="fal fa-flag"><\/i><\/a><\/div><div class="comment-reply"><\/div><\/div>'),a=`<div class="comment-item{7}" id="{0}"><div class="user"><img src="{1}" alt="{2}" class="img-fluid avatar">{2}<time class="time-ago" datetime="{3}">{4}</time></div><div class="text">{5}</div><div class="comment-react"><a href="javascript:void(0)" title="Thích" class="text-link like"><i class="far fa-thumbs-up"></i><span id="likeNumber_{0}">{6}</span></a><a href="javascript:void(0)" title="Trả lời" class="text-link reply"><i class="fal fa-reply"></i></a><a href="javascript:void(0)" title="Chia sẻ lên facebook" class="text-link share-quote"><i class="fal fa-share"></i></a><a href="javascript:void(0)" title="Báo cáo bình luận không phù hợp" class="text-link report"><i class="fal fa-flag"></i></a></div></div>`.format(e,r,i,u,"vừa đăng",t,"",""),o!==""&&($(l).html()==="undefined"&&$(l).append(a),$(l).html().indexOf("view-more")>-1?$(l).find(".view-more").before(a):$(l).append(a)),v=$(".story__react.comment[data-article='"+n.replace("post","")+"']").find("span"),$(v).html(s),$("#"+n).parent().css("display","block"),$("#toast-avatar").css({"background-image":"url("+r+")"}),$("#toast-username").html(i),$("#toast-link").text(decodeURI(h)).attr("href",c),$("#toast").toast("show")):alertify.notify(t,"error",3)};$.connection.hub.start().done(function(){$(document).on("keyup",".inputComment",function(t){if(t=t||window.event,Member.RequireLogin(),t.keyCode===13&&t.originalEvent.shiftKey===!1){const t=$(this).html().replace("<p><br><\/p>","").replace("<p><\/p>","").replace("<div><br><\/div>","").trim();if(console.dir(t),isBlank(t)){alertify.notify("Nhập nội dung bình luận","error",3);return}return n.server.sendComment($(this).attr("data-id"),t,Client.UserID,Client.UserName,Client.UserAvatar,$(this).attr("data-parent")===undefined?"":$(this).attr("data-parent")),$(this).html("").css({height:36}),!1}});$(document).on("click",".input-wrap .btn-send",function(){if(!Member.RequireLogin()){var t=$(this).parent().find(".editor");const i=$(t).html().replace("<p><br><\/p>","").replace("<p><\/p>","").replace("<div><br><\/div>","").trim();if(isBlank(i)){alertify.notify("Nhập nội dung bình luận","error",3);return}return n.server.sendComment($(t).attr("data-id"),i,Client.UserID,Client.UserName,Client.UserAvatar,$(t).attr("data-parent")===undefined?"":$(t).attr("data-parent")),$(t).html("").css({height:36}),!1}});$(document).on("click",".comment-react .like",function(){n.server.likeAction($(this).closest(".comment__item").attr("id"),1);$(this).removeClass("like").addClass("unlike");$(this).find("i").removeClass("far fa-thumbs-up").addClass("fas fa-thumbs-up")});$(document).on("click",".comment-react .unlike",function(){n.server.likeAction($(this).closest(".comment__item").attr("id"),-1);$(this).removeClass("unlike").addClass("like");$(this).find("i").removeClass("fas fa-thumbs-up").addClass("far fa-thumbs-up")})});GetArticleSave()});$(document).on("focusin",".inputComment",function(){Member.RequireLogin()});
    $(document).on("click",".more-comment",function(n){$(this).prev().remove();var t=$(this).closest(".text").find(".vm-data"),i=t.html();$(this).replaceWith(i);$(t).remove();n.preventDefault()});$(document).on("click",".story__react.love",function(n){Member.RequireLogin();
        var i=$(this).attr("data-article"),t=$(this);$(this).hasClass("is-checked")?$.getJSON("/ajax/article.ashx?type=unbookmark&id="+$(t).attr("data-id"),function(n){n.Status===!0?($(t).removeClass("is-checked"),alertify.notify("Đã bỏ thích bài viết","success",3)):alertify.notify(n.Content,"error",3)}):$.getJSON("/ajax/article.ashx?type=bookmark&articleID="+i,function(n){n.Status===!0?($(t).addClass("is-checked"),alertify.notify("Đã lưu bài yêu thích","success",3)):alertify.notify(n.Content,"error",3)});n.preventDefault()});$(document).on("click",".comment-react .reply",function(n){Member.RequireLogin();$(".subInputComment").remove();var t=`<div class="input-wrap is-active subInputComment"><div class="avatar avatarUser"></div><div class="content"><div contenteditable="true" draggable="true" class="form-control bg-light editor inputComment auto-size" spellcheck="false" data-id="{0}" data-parent={1}></div><span class="fal fa-image commentUploadImage"><input type="file" accept="image/png, image/jpeg, img/gif" onchange="Images.UploadImage(this,$(this).parent().prev())" spellcheck="false"></span><span class="btn-send pointer" title="Gửi bình luận"><i class="fas fa-paper-plane"></i></span></div></div>`;t=t.format($(this).closest(".comment-parent").parent().attr("id"),$(this).closest(".comment-parent").attr("id"));$(this).parent().after(t);n.preventDefault()});$(document).on("click",".story__react.comment",function(n){Comment.GetCommentsByAticle($(this).attr("data-article"),1);n.preventDefault()});$(document).on("click",".view-all-subcomment",function(){$(this).parent().find(".comment-item.d-none").removeClass("d-none");$(this).remove()});$(document).on("click",".view-more-subcomment",function(){const t=$(this).parent().find(".comment-item.d-none");for(var n=0;n<t.length;n++){if(n>9)break;$(t[n]).removeClass("d-none")}$(this).parent().find(".comment-item.d-none").length===0&&$(this).remove()});$(".share-quote").click(function(){var n=$(this).closest(".comment-listing").attr("data-url"),t=$(this).parent().prev().text().replace("... xem thêm","");popitup("https://www.facebook.com/sharer/sharer.php?u="+n+"&quote="+t)});$(".inputComment").bind("paste",function(n){var u=$(this),t=n.originalEvent.clipboardData.getData("text"),i=0,e,f,r,o;if((t.startsWith("http")||t.startsWith("//"))&&t.length<400)return getContentType(t,function(n){try{n.toString().startsWith("image")&&Images.UploadImageViaUrl(t,undefined,function(n){$(u).append('<figure><img style="max-width:100%" src="'+Client.UrlStatic+"images/upload/"+n.FilePath+'" /><\/figure>');i+=n.Height;autosize(u,i)})}catch(r){console.error(r)}}),document.execCommand("insertText",!1,t),autosize(this),!1;for(e=createHTMLNode(n.originalEvent.clipboardData.getData("text/html")),f=e.getElementsByTagName("img"),r=0;r<f.length;r++)Images.UploadImageViaUrl(f[r].src,undefined,function(n){document.execCommand("insertHTML",!1,'<figure><img style="max-width:100%" src="'+Client.UrlStatic+"images/upload/"+n.FilePath+'" /><\/figure>');i+=n.Height;autosize(u,i)});return o=replaceBreaksWithParagraphs(t),document.execCommand("insertHTML",!1,o),autosize(this,i),!1});var dicComments={},dicSubComments=[],Comment=function(){let t=function(){};const i=`<div class="comment__item comment-parent{8}" id="{5}">
	<div class="avatar"><img src="{0}" alt="{1}" class="img-fluid rounded-circle"></div>
	<div class="content">
		<h3 class="name">{1} <time class="time-ago" datetime="{2}">{3}</time></h3>
		<div class="text">{4}</div>       
    </div>
    <div class="comment-react">
		<a href="javascript:void(0)" title="Thích" class="text-link like"><i class="far fa-thumbs-up"></i> <span id="likeNumber_{5}">{6}</span></a>
        <a href="javascript:void(0)" title="Trả lời" class="text-link reply"><i class="fal fa-reply"></i></a>
        <a href="javascript:void(0)" title="Chia sẻ lên facebook" class="text-link share"><i class="fal fa-share"></i></a>
        <a href="javascript:void(0)" title="Báo cáo bình luận không phù hợp" class="text-link report"><i class="fal fa-flag"> </i></a>
	</div>{7}
    </div>`,n=`<div class="comment-item{7}" id="{0}"><div class="user"><img src="{1}" alt="{2}" class="img-fluid avatar">{2}<time class="time-ago" datetime="{3}">{4}</time></div><div class="text">{5}</div><div class="comment-react"><a href="javascript:void(0)" title="Thích" class="text-link like"><i class="far fa-thumbs-up"></i><span id="likeNumber_{0}">{6}</span></a><a href="javascript:void(0)" title="Trả lời" class="text-link reply"><i class="fal fa-reply"></i></a><a href="javascript:void(0)" title="Chia sẻ lên facebook" class="text-link share-quote"><i class="fal fa-share"></i></a><a href="javascript:void(0)" title="Báo cáo bình luận không phù hợp" class="text-link report"><i class="fal fa-flag"></i></a></div></div>`,r=`<div class="input-wrap">
        <div class="avatar avatarUser"></div>
        <div class="content">
            <div contenteditable="true" draggable="true" class="form-control bg-light editor inputComment auto-size" spellcheck="false" data-id="post{0}"></div>
            <span class="fal fa-image commentUploadImage">
                <input type="file" accept="image/png, image/jpeg, img/gif" onchange="Images.UploadImage(this,$(this).parent().prev())" />
            </span>
            <span class="btn-send pointer" title="Gửi bình luận"><i class="fas fa-paper-plane"></i></span>
        </div>
    </div>`;
    let u=function(t,u){
    if(!($("#post"+t).next().length>0)){
        let f="";
        $.getJSON("/ajax/comment.ashx?type=getbyarticle&articleID="+t+"&page="+u,function(u){
            dicComments["c_"+t]=u;const s=[];
            for(let n=0;n<u.length;n++){
                let t=u[n];
                t.ParentID!=="00000000-0000-0000-0000-000000000000"&&(s.push(t),dicSubComments.push(t))
            }
            let e=0;
            for(let t=0;t<u.length;t++){
                let r=u[t];
                if(r.ParentID==="00000000-0000-0000-0000-000000000000"){
                    e++;const o=s.filter(function(n){return n.ParentID===r.ID});
                    let t="",
                    h=`<div class="view-more {1}"><a href="javascript:void(0)" class="text-dark ">Xem thêm<span> {0}</span> trả lời bình luận</a></div>`,
                    u=0;
                    for(let i=0;i<o.length;i++){
                        const r=o[i];i<3?t+=n.format(r.ID,r.Avatar,r.UserName,r.TimeString,timeSince(Utils.ConvertJsonToDate(r.CreatedDate)),r.Content,r.LikeCount===0?"":r.LikeCount,""):(u++,t+=n.format(r.ID,r.Avatar,r.UserName,r.TimeString,timeSince(Utils.ConvertJsonToDate(r.CreatedDate)),r.Content,r.LikeCount===0?"":r.LikeCount," d-none"),i===o.length-1&&(t+=h.format(u>10?"":u,u>10?"view-more-subcomment":"view-all-subcomment")))}t='<div class="comment-reply">'+t+"<\/div>";f+=i.format(r.Avatar,r.UserName,r.TimeString,timeSince(Utils.ConvertJsonToDate(r.CreatedDate)),r.Content,r.ID,r.LikeCount===0?"":r.LikeCount,t,e<4?"":" d-none")}}let o="";
                        e<13&&e>3?o=`<div class="view-more"><a href="javascript:void(0)" title="Xem thêm bình luận" class="text-dark showAllCommentParent">Xem thêm ${e-3} bình luận</a></div>`:e>13&&(o=`<div class="view-more"><a href="javascript:void(0)" title="Xem thêm bình luận" class="text-dark showMoreCommentParent">Xem thêm bình luận</a></div>`);$("#post"+t).append(f).after(r.format(t)).after(o)})}};$(document).on("click",".showAllCommentParent",function(){$(this).parent().prev().find(".comment__item.comment-parent.d-none").removeClass("d-none");$(this).remove()});
                        return $(".showMoreCommentParent").click(function(){
                            var n=$(this).parent().prev().find(".comment__item.comment-parent.d-none");
                            n.each(function(n,t){t!==10&&$(this).removeClass("d-none")});
                            n.length<11&&$(this).remove()}),{PushToServer:t,GetCommentsByAticle:u}}();
                            $(function(){$(".composer-wrap .tool .tool-btn").on("click",function(){
                                expandComposer();
                                $(".composer-wrap .tool .btn-close").on("click",function(){
                                    collapseComposer()
                                });
                                $(document).keyup(function(n){n.key==="Escape"&&collapseComposer()})});
                                $("#mainComposer").on("focus",function(){
                                    if(!Member.RequireLogin()){
                                        expandComposer();
                                        $("#editor").focus();
                                        $(".composer-wrap .tool .btn-close").on("click",function(){collapseComposer()});
                                        $(document).keyup(function(n){n.key==="Escape"&&collapseComposer()})}});
                                        $(".composer-mask").on("click",function(){collapseComposer()});
                                        $(".story--flex .comment").on("click",function(n){
                                            $(this).closest(".story__footer").siblings(".story__comment").toggle();
                                            n.preventDefault()});if($(".story--flex .story__images").addClass("lightgallery"),$(".lightgallery").length>0){var n=$(".lightgallery");n.lightGallery({counter:!1})}$("#editor").bind("paste",function(n){var r,e,i,s,u,t,h,o,f,c;if(n.originalEvent.clipboardData.items){for(r=n.originalEvent.clipboardData.items,e=!1,i=0;i<r.length;i++)r[i].type.indexOf("image")!==-1&&(s=r[i].getAsFile(),u=new FileReader,u.readAsDataURL(s),u.onloadend=function(){Images.UploadImageBase64(u.result,n.currentTarget)},e=!0);if(e===!1){if(t=n.originalEvent.clipboardData.getData("text"),(t.startsWith("http")||t.startsWith("//"))&&t.length<400)return getContentType(t,function(n){try{n.toString().startsWith("image")?Images.UploadImageViaUrl(t,"#loading-container"):ScrapeArticle(t)}catch(i){ScrapeArticle(t)}}),document.execCommand("insertText",!1,t),autosize(this),!1;for(h=createHTMLNode(n.originalEvent.clipboardData.getData("text/html")),o=h.getElementsByTagName("img"),f=0;f<o.length;f++)Images.UploadImageViaUrl(o[f].src,"#loading-container");c=replaceBreaksWithParagraphs(t);document.execCommand("insertHTML",!1,c)}return autosize(this),!1}});$("#btnPost").click(function(){PostStatus($("#hdGalleryImages").val(),$("#editor").html())});$(".more-content").click(function(){$(this).next().removeClass("d-none");$(this).remove()})});Following=function(){let n=function(n){Member.RequireLogin()||$.getJSON("/ajax/following.ashx",{type:"follow",FollowerID:n},function(n,t){if(t!=="success"||n.Status!==!0)alertify.notify(n.Content,"error",3);else{alertify.notify("Theo dõi người dùng thành công","success",3);var i=JSON.parse(n.Content);MemberFollowing.push([i]);$(".moreActionArticle[data-user='"+i.FollowerID+"']").each(function(){$(this).find(".aFollow").replaceWith(`<a class="dropdown-item text-danger aUnFollow" href="javascript:void(0)" onclick="Following.UnFollow('`+i.ID+`')" > <i class="fal fa-user-minus mr-2"></i>Bỏ theo dõi tác giả</a>`)})}})},t=function(){$(".moreActionArticle").each(function(){const n=$(this).attr("data-user"),t=MemberFollowing.find(t=>t.FollowerID.toString()===n);t!==undefined?$(this).prepend(`<a class="dropdown-item text-danger aUnFollow" href="javascript:void(0)" onclick="Following.UnFollow('`+t.ID+`')" > <i class="fal fa-user-minus mr-2"></i>Bỏ theo dõi tác giả</a>`):Client.UserID.toString()!==n.toString()&&$(this).prepend(`<a class="dropdown-item aFollow" href="javascript:void(0)" onclick="Following.Follow(`+n+`)" > <i class="fal fa-user-plus mr-2"></i>Theo dõi tác giả</a>`)})},i=function(n){if(!Member.RequireLogin()){var t=MemberFollowing.find(t=>t.ID.toString()===n);const i=MemberFollowing.findIndex(t=>t.ID.toString()===n);i>-1&&(MemberFollowing.splice(i,1),$(".moreActionArticle[data-user='"+t.FollowerID+"']").each(function(){$(this).find(".aUnFollow").replaceWith(`<a class="dropdown-item aFollow" href="javascript:void(0)" onclick="Following.Follow(`+t.FollowerID+`)" > <i class="fal fa-user-plus mr-2"></i>Theo dõi tác giả</a>`)}),$.getJSON("/ajax/following.ashx",{type:"unfollow",id:t.ID},function(n,t){t!=="success"||n.Status!==!0?alertify.notify(n.Content,"error",3):alertify.notify("Bỏ theo dõi người dùng thành công","success",3)}))}};return{Follow:n,UnFollow:i,processFollowing:t}}();$(document).ready(function(){Following.processFollowing()});FollowingArticles=function(){let n=function(){$(".moreActionArticle").each(function(){const n=$(this).attr("data-article"),t=ArticleFollowing.find(t=>t.NewsID.toString()===n);t!==undefined?$(this).prepend(`<a class="dropdown-item text-danger aUnNotiArticle" href="javascript:void(0)"  onclick="FollowingArticles.UnFollow('`+t.ID+`')"><i class="fal fa-bell-slash mr-2"></i>Tắt thông báo bình luận</a>`):$(this).prepend(`<a class="dropdown-item aNotiArticle" href="javascript:void(0)" onclick="FollowingArticles.Follow('`+n+`')"><i class="fal fa-bell mr-2"></i>Thông báo khi có bình luận</a>`)})},t=function(n){Member.RequireLogin()||$.getJSON("/ajax/commentnotification.ashx",{type:"follow",ArticleID:n},function(n,t){if(t!=="success"||n.Status!==!0)alertify.notify(n.Content,"error",3);else{alertify.notify("Đã bật thông báo khi có bình luận mới","success",3);var i=JSON.parse(n.Content);ArticleFollowing.push(i);$(".moreActionArticle[data-article='"+i.NewsID+"']").each(function(){$(this).find(".aNotiArticle").replaceWith(`<a class="dropdown-item text-danger aUnNotiArticle" href="javascript:void(0)"  onclick="FollowingArticles.UnFollow('`+i.ID+`')"><i class="fal fa-bell-slash mr-2"></i>Tắt thông báo bình luận</a>`)})}})},i=function(n){if(!Member.RequireLogin()){var t=ArticleFollowing.find(t=>t.ID===n);const i=ArticleFollowing.findIndex(t=>t.ID===n);i>-1&&(ArticleFollowing.splice(i,1),$(".moreActionArticle[data-article='"+t.NewsID+"']").each(function(){$(this).find(".aUnNotiArticle").replaceWith(`<a class="dropdown-item aNotiArticle" href="javascript:void(0)" onclick="FollowingArticles.Follow('`+t.NewsID+`')"><i class="fal fa-bell mr-2"></i>Thông báo khi có bình luận</a>`)}),$.getJSON("/ajax/commentNotification.ashx",{type:"unfollow",id:t.ID},function(n,t){t!=="success"||n.Status!==!0?alertify.notify(n.Content,"error",3):alertify.notify("Tắt thông báo bình luận thành công","success",3)}))}};return{ProcessFollowing:n,Follow:t,UnFollow:i}}();$(document).ready(function(){FollowingArticles.ProcessFollowing()});ReportArticle=function(){let n=function(n,t,i){$.getJSON("/ajax/reportarticle.ashx",{ArticleID:n,ReportID:t,Content:i},function(n){n.Status===!0?alertify.notify("Cảm ơn bạn đã gửi báo cáo cho chúng tôi","success",3):alertify.notify(n.Content,"error",3);$("#modalReport").modal("hide")})},t=function(t,i){if(Member.RequireLogin())$("#modalReport").modal("hide"),alertify.notify("Đăng nhập để gửi báo cáo","error",3),$("#loginModal").modal();else{if(i===5)return!1;n(t,i,"")}};return{Send:t,PostData:n}}();$(document).ready(function(){let n=0;$(".reportArticle").click(function(){n=$(this).attr("data-article")});$("a.reportArticleType").click(function(){ReportArticle.Send(n,$(this).attr("data-id"))});$("#btnSendReportArticle").click(function(){const t=$("#txtContentReportArticle").val();if(isBlank(t))return alertify.notify("Nhập nội dung phản hồi","error",3),$("#txtContentReportArticle").focus(),!1;ReportArticle.PostData(n,5,t)})});ArticlePr=function(){let n=function(){$.getJSON("/ajax/newspr.ashx",function(n){$.each(n,function(n,t){$(".news-main article.story")[t.Position].before($("#article"+t.NewsID)[0])})})};return{ProcessDisplay:n}}();ArticlePr.ProcessDisplay();