/*
jquery.datepicker plugin programmed by Pham Duy(duy1279@gmail.com)
*/
function bf(el,options){this.el=$(el);this.O=0;this.G=0;this.aj=0;this.J=0;this.F=0;this.calendar=null;this.isOpen=false;this.selectedDate=null;this.options={minYear:1900,maxYear:2099,dateFormat:'dd/MM/yyyy',t:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],L:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],zIndex:1100};this.initialize();this.setOptions(options);};bf.prototype={initialize:function(){var self=this;var aX=this.el.attr('id')+"_calendar";this.calendar=$('#'+aX);if(this.calendar.length===0){this.calendar=$('<div id="'+aX+'" class="datepicker" style="position:absolute;display:none" />').appendTo(document.body);}this.calendar.empty();this.el.unbind('click').bind('click',function(e){self.au(e);return false;});this.calendar.unbind('mousedown').bind('mousedown',function(e){self.aP(e);return false;});},setOptions:function(options){this.options=$.extend(this.options,options);this.k();},au:function(e){this.open();e.preventDefault();e.stopPropagation();},aP:function(e){clearTimeout(this.F);e.preventDefault();e.stopPropagation();},open:function(){clearTimeout(this.F);var self=this;$(document).unbind('mousedown',document_OnMouseDown);$(document).bind('mousedown',document_OnMouseDown);function document_OnMouseDown(){$(document).unbind('mousedown',document_OnMouseDown);if(!self.isOpen)return;self.be();};if(this.isOpen)return;this.isOpen=true;this.calendar.show();var offset=this.el.offset();var left=offset.left;var top=offset.top+this.el.innerHeight();this.calendar.css({left:left+"px",top:top+"px"});var val=this.ac(this.el.val());if(val.length>0){var d=this.parse(val,this.options.dateFormat);if(d)this.selectedDate=d;}var date=this.selectedDate||new Date();this.J=0;this.aj=date.getDate();this.O=date.getFullYear();this.G=date.getMonth()+1;this.k();},close:function(){this.isOpen=false;clearTimeout(this.F);this.calendar.hide();this.calendar.empty();},be:function(){var self=this;clearTimeout(this.F);this.F=setTimeout(function(){self.close();},200);},k:function(){var self=this;if(!this.isOpen)return;this.calendar.empty();var header=$('<div class="datepicker-header" />').appendTo(this.calendar);var aS=$('<a class="prev-month" style="cursor:pointer" />').appendTo(header);var bz=$('<a class="next-month" style="cursor:pointer" />').appendTo(header);var bu=$('<a style="cursor:pointer" />').appendTo(header);bu.click(function(){self.ar();});var year=this.O;var month=this.G;var H=year;var R=year;var j=month-1;var l=month+1;if(j<1){j=12;H=year-1;}if(l>12){l=1;R=year+1;}var bB=this.am(j,H);var start=this.aZ(year,month,1);var end=start+this.am(month,year);var C,index,t;var h;aS.click(function(){if(H>=self.options.minYear){self.G=j;self.O=H;self.k();}});bz.click(function(){if(R<=self.options.maxYear){self.G=l;self.O=R;self.k();}});bu.text(this.options.L[month-1]+", "+year);var bn=$('<div class="datepicker-dayofweek" />').appendTo(this.calendar);for(var c=0;c<7;c++){t=$('<span/>').appendTo(bn);t.text(this.options.t[c]);}var div=$('<div class="datepicker-days" />').appendTo(this.calendar);for(var r=0;r<6;r++){for(var c=0;c<7;c++){index=r*7+c;C=$('<a />').appendTo(div);if(index<start){h=(bB-start+index+1);C.addClass("inv");C.click(function(date){return function(){self.ao(date);}}(new Date(H,j-1,h)));}else if(index>=end){h=(index-end+1);C.addClass("inv");C.click(function(date){return function(){self.ao(date);}}(new Date(R,l-1,h)));}else{h=(index-start+1);if(h===this.aj)C.addClass("selected");C.click(function(date){return function(){self.ao(date);}}(new Date(year,month-1,h)));}C.text(h);}}},ao:function(date){this.selectedDate=date;this.el.val(this.toDateString(this.selectedDate,this.options.dateFormat));this.close();},ar:function(){var self=this;this.calendar.empty();var year=this.O;var month=this.G;var by=$('<div class="datepicker-months" />').appendTo(this.calendar);var K=$('<div class="datepicker-years" />').appendTo(this.calendar);var T,V,bG,bJ;for(var m=0;m<6;m++){T=(m==month-1)?$('<a class="selected"/>'):$('<a/>');V=(m+6==month-1)?$('<a class="selected"/>'):$('<a/>');T.appendTo(by);V.appendTo(by);T.text(this.options.L[m]).click(function(month){return function(){self.ab(month);}}(m+1));V.text(this.options.L[m+6]).click(function(month){return function(){self.ab(month);}}(m+7));}if(this.J<=0)this.J=year-4;var H=$('<a class="prev-year"/>').appendTo(K);var R=$('<a class="next-year"/>').appendTo(K);H.click(function(e){self.J-=10;if(self.J<self.options.minYear){self.J=self.options.minYear;}self.ar();e.preventDefault();e.stopPropagation();return false;});R.click(function(e){self.J+=10;if(self.J>self.options.maxYear-9){self.J=self.options.maxYear-9;}self.ar();e.preventDefault();e.stopPropagation();return false;});for(var y=this.J;y<this.J+5;y++){bG=(y==year)?$('<a class="selected"/>'):$('<a/>');bJ=(y+5==year)?$('<a class="selected"/>'):$('<a/>');bG.appendTo(K);bJ.appendTo(K);bG.text(y).click(function(year){return function(){self.ag(year);}}(y));bJ.text(y+5).click(function(year){return function(){self.ag(year);}}(y+5));}},ag:function(year){if(year>=this.options.minYear&&year<=this.options.maxYear){this.O=year;this.k();}},ab:function(month){if(month>=1&&month<=12){this.G=month;this.k();}},val:function(value){if(value)this.selectedDate=value;else return this.selectedDate;},text:function(value){if(value)$(this.el).text(value);else return $(this.el).text();},am:function(month,year){return new Date(year,month,0).getDate();},aZ:function(year,month){var d=new Date(year,month-1,1);return d.getDay();},ac:function(bN){return bN.replace(/^\s\s*/,'').replace(/\s\s*$/,'');},toDateString:function(d,format){var h=d.getDate();var month=d.getMonth()+1;var year=d.getFullYear();if(format.indexOf('dd')!== -1)format=format.replace('dd',(h<10?'0':'')+h);else if(format.indexOf('d')!== -1)format=format.replace('d',h);if(format.indexOf('MM')!== -1)format=format.replace('MM',(month<10?'0':'')+month);else if(format.indexOf('M')!== -1)format=format.replace('M',month);if(format.indexOf('yyyy')!== -1)format=format.replace('yyyy',year);return format;},parse:function(s,format){var h=0;var month=0;var year=0;var aA=format.indexOf('d');var as=format.indexOf('M');var bL=format.indexOf('yyyy');format=format.replace(/(dd|d)/g,'(\\d+)');format=format.replace(/(MM|M)/g,'(\\d+)');format=format.replace(/(yyyy)/g,'(\\d+)');var reg=new RegExp(format,'g');var m=reg.exec(s);if(m){var v=[aA,as,bL];v.sort();for(var i=0;i<v.length;i++){if(v[i]===aA)h=parseInt(m[i+1]);else if(v[i]===as)month=parseInt(m[i+1]);else if(v[i]===bL)year=parseInt(m[i+1]);}}if((h>0&&h<=31)&&(month>0&&month<=12)&&(year>=1754&&year<=9999))return new Date(year,month-1,h);return null;}};$.fn.datepicker=function(options){return new bf($(this).get(0),options);}